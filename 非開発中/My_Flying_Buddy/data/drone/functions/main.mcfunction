
#スラッシュパルス
execute as @e[tag=SlashShot] at @s run function drone:projectile/slash_pulse

#てきお
execute as @a unless entity @s[nbt=!{SelectedItem:{tag:{ItemName:Tech_Kit_Operator}}},nbt=!{Inventory:[{Slot:-106b,tag:{ItemName:Tech_Kit_Operator}}]}] at @s run function drone:weapon/tech_kit_ope

#ポーター
execute as @e[tag=Drone_Porter] at @s run function drone:mob/buddy_porter

#ドローン（コア）
execute as @e[tag=Drone_Pos] at @e[tag=Drone_Core] if score @s ScoreID2 = @e[tag=Drone_Core,limit=1,sort=nearest] ScoreID2 facing entity @s[distance=1..40] eyes unless entity @e[type=#drone:can_pick,distance=..20,tag=!Drone_Caught] run summon area_effect_cloud ^ ^ ^0.1 {Duration:1,Radius:0f,Tags:[pos]}
execute as @e[tag=Drone_Core] at @s run function drone:mob/buddy_core
execute as @e[tag=Drone_Caught] at @s at @e[tag=Drone_Core,limit=1] run tp @s ~ ~ ~
execute as @e[tag=Drone_Caught] at @s run tp @s @e[tag=Drone_Porter,limit=1,sort=nearest,distance=..2]

#ドローン（モデル）
execute as @e[tag=Drone_Model] at @s run function drone:mob/buddy_model

#ドローン（共通）
execute as @e[tag=Drone_Common] at @s run function drone:mob/buddy_common

#スコアボード
scoreboard players set @a[scores={Drone_Sneak=1..}] Drone_Sneak 0
scoreboard players reset @a[nbt=!{SelectedItem:{tag:{ItemName:Tech_Kit_Operator}}},nbt=!{Inventory:[{Slot:-106b,tag:{ItemName:Tech_Kit_Operator}}]}] Drone_Sneak_Hold
scoreboard players reset @a[nbt=!{SelectedItem:{tag:{ItemName:Tech_Kit_Operator}}},nbt=!{Inventory:[{Slot:-106b,tag:{ItemName:Tech_Kit_Operator}}]}] Drone_RClick

scoreboard players set @e[tag=Drone_Common,scores={Drone_Mode=2..}] Drone_Mode 0

#クラフト(オペレーター）
execute as @e[tag=Custom_Crafter_Crafting] at @s if block ~ ~-0.5 ~ minecraft:dropper{Items:[{Slot:1b,id:"minecraft:ender_pearl",Count:1b},{Slot:2b,id:"minecraft:redstone_block",Count:1b},{Slot:3b,id:"minecraft:ender_pearl",Count:1b},{Slot:4b,id:"minecraft:diamond_sword",Count:1b},{Slot:5b,id:"minecraft:obsidian",Count:1b},{Slot:6b,id:"minecraft:iron_block",Count:1b},{Slot:7b,id:"minecraft:obsidian",Count:1b}]} run tag @s add Custom_Crafter_Succes
execute as @e[tag=Custom_Crafter_Crafting] at @s if block ~ ~-0.5 ~ minecraft:dropper{Items:[{Slot:1b,id:"minecraft:ender_pearl",Count:1b},{Slot:2b,id:"minecraft:redstone_block",Count:1b},{Slot:3b,id:"minecraft:ender_pearl",Count:1b},{Slot:4b,id:"minecraft:diamond_sword",Count:1b},{Slot:5b,id:"minecraft:obsidian",Count:1b},{Slot:6b,id:"minecraft:iron_block",Count:1b},{Slot:7b,id:"minecraft:obsidian",Count:1b}]} run give @p minecraft:carrot_on_a_stick{Unbreakable: 1b, CustomModelData: 4, HideFlags: 3, display: {Lore: ['{"text":"Category:Sword","color":"gray","italic":false}','{"text":" "}','{"text":"[RClick: Blade Shot]","color":"white","italic":false}','{"text":"[Tap Sneak: Change Buddy mode]","color":"white","italic":false}','{"text":"[Hold Sneak: Call Buddy/Pickup]","color":"white","italic":false}','{"text":" "}','{"text":"Buddyの制御デバイス。見ての通り剣でもある。","color":"white","italic":false}', '{"text":"2つ合わせれば便利、ということなのだろうか。","color":"white","italic":false}', '{"text":" "}', '{"text":"Damage +7","color":"blue","italic":false}'], Name: '{"text":"Tech Kit:Operator","color":"gold","italic":false}'}, ItemName: "Tech_Kit_Operator", Damage: 0, AttributeModifiers: [{UUIDMost: 884387, UUIDLeast: 700932, Amount: 6.5d, Slot: "mainhand", AttributeName: "generic.attackDamage", Operation: 0, Name: "generic.attackDamage"}, {UUIDMost: 410939, UUIDLeast: 67339, Amount: -2.4d, AttributeName: "generic.attackSpeed", Operation: 0, Name: "generic.attackSpeed"}]}
execute as @e[tag=Custom_Crafter_Crafting] at @s if block ~ ~-0.5 ~ minecraft:dropper{Items:[{Slot:1b,id:"minecraft:ender_pearl",Count:1b},{Slot:2b,id:"minecraft:redstone_block",Count:1b},{Slot:3b,id:"minecraft:ender_pearl",Count:1b},{Slot:4b,id:"minecraft:diamond_sword",Count:1b},{Slot:5b,id:"minecraft:obsidian",Count:1b},{Slot:6b,id:"minecraft:iron_block",Count:1b},{Slot:7b,id:"minecraft:obsidian",Count:1b}]} run data merge block ~ ~-1 ~ {Items:{}}
#クラフト（バディ）
execute as @e[tag=Custom_Crafter_Crafting] at @s if block ~ ~-0.5 ~ minecraft:dropper{Items:[{Slot:0b,id:"minecraft:ender_pearl",Count:1b},{Slot:1b,id:"minecraft:redstone_block",Count:1b},{Slot:2b,id:"minecraft:ender_pearl",Count:1b},{Slot:3b,id:"minecraft:obsidian",Count:1b},{Slot:4b,id:"minecraft:diamond",Count:1b},{Slot:5b,id:"minecraft:obsidian",Count:1b},{Slot:6b,id:"minecraft:ender_pearl",Count:1b},{Slot:7b,id:"minecraft:redstone_block",Count:1b},{Slot:8b,id:"minecraft:ender_pearl",Count:1b}]} run tag @s add Custom_Crafter_Succes
execute as @e[tag=Custom_Crafter_Crafting] at @s if block ~ ~-0.5 ~ minecraft:dropper{Items:[{Slot:0b,id:"minecraft:ender_pearl",Count:1b},{Slot:1b,id:"minecraft:redstone_block",Count:1b},{Slot:2b,id:"minecraft:ender_pearl",Count:1b},{Slot:3b,id:"minecraft:obsidian",Count:1b},{Slot:4b,id:"minecraft:diamond",Count:1b},{Slot:5b,id:"minecraft:obsidian",Count:1b},{Slot:6b,id:"minecraft:ender_pearl",Count:1b},{Slot:7b,id:"minecraft:redstone_block",Count:1b},{Slot:8b,id:"minecraft:ender_pearl",Count:1b}]} run give @p minecraft:armor_stand{display:{Name:'{"text":"Tech Kit:Buddy","color":"gold","italic":false}',Lore:['{"text":"Category:Minion?","color":"gray","italic":false}','{"text":" "}','{"text":"宙に浮くへんてこなマシン…？","color":"white","italic":false}','{"text":"それなりに便利で、ある種の愛嬌もあるが、","color":"white","italic":false}','{"text":"あまり賢くはないのでよく地形に引っかかる。","color":"white","italic":false}']},CustomModelData:12,EntityTag:{NoGravity:1b,Small:1b,Invisible:1b,Tags:["Drone_Model","Drone_Model0","Drone_Common","NeedID"],Pose:{Head:[0.1f,0.1f,0.1f]},DisabledSlots:4144959,ArmorItems:[{},{},{},{id:"minecraft:armor_stand",Count:1b,tag:{CustomModelData:12}}]}} 1
execute as @e[tag=Custom_Crafter_Crafting] at @s if block ~ ~-0.5 ~ minecraft:dropper{Items:[{Slot:0b,id:"minecraft:ender_pearl",Count:1b},{Slot:1b,id:"minecraft:redstone_block",Count:1b},{Slot:2b,id:"minecraft:ender_pearl",Count:1b},{Slot:3b,id:"minecraft:obsidian",Count:1b},{Slot:4b,id:"minecraft:diamond",Count:1b},{Slot:5b,id:"minecraft:obsidian",Count:1b},{Slot:6b,id:"minecraft:ender_pearl",Count:1b},{Slot:7b,id:"minecraft:redstone_block",Count:1b},{Slot:8b,id:"minecraft:ender_pearl",Count:1b}]} run data merge block ~ ~-1 ~ {Items:{}}
#クラフト(ポートマーカー)
execute as @e[tag=Custom_Crafter_Crafting] at @s if block ~ ~-0.5 ~ minecraft:dropper{Items:[{Slot:3b,id:"minecraft:iron_ingot",Count:1b},{Slot:4b,id:"minecraft:chest",Count:1b},{Slot:5b,id:"minecraft:iron_ingot",Count:1b},{Slot:6b,id:"minecraft:iron_ingot",Count:1b},{Slot:7b,id:"minecraft:redstone_block",Count:1b},{Slot:8b,id:"minecraft:iron_ingot",Count:1b}]} run tag @s add Custom_Crafter_Succes
execute as @e[tag=Custom_Crafter_Crafting] at @s if block ~ ~-0.5 ~ minecraft:dropper{Items:[{Slot:3b,id:"minecraft:iron_ingot",Count:1b},{Slot:4b,id:"minecraft:chest",Count:1b},{Slot:5b,id:"minecraft:iron_ingot",Count:1b},{Slot:6b,id:"minecraft:iron_ingot",Count:1b},{Slot:7b,id:"minecraft:redstone_block",Count:1b},{Slot:8b,id:"minecraft:iron_ingot",Count:1b}]} run give @p armor_stand{display:{Name:'{"text":"Tech Kit:Port Marker","color":"white","italic":false}',Lore:['{"text":"Category:Utility","color":"gray","italic":false}','{"text":" "}','{"text":"ホッパーの上に置くことができ、","color":"white","italic":false}','{"text":"待機モードのBuddyのポート地点になる。","color":"white","italic":false}']},CustomModelData:13,EntityTag:{Small:1b,Invisible:1b,Tags:["Drone_Porter","NeedID"],Rotation:[0F,0F],Pose:{Head:[0f,0f,0.1f]},DisabledSlots:4144959,ArmorItems:[{},{},{},{id:"minecraft:armor_stand",Count:1b,tag:{CustomModelData:13}}]}} 1
execute as @e[tag=Custom_Crafter_Crafting] at @s if block ~ ~-0.5 ~ minecraft:dropper{Items:[{Slot:3b,id:"minecraft:iron_ingot",Count:1b},{Slot:4b,id:"minecraft:chest",Count:1b},{Slot:5b,id:"minecraft:iron_ingot",Count:1b},{Slot:6b,id:"minecraft:iron_ingot",Count:1b},{Slot:7b,id:"minecraft:redstone_block",Count:1b},{Slot:8b,id:"minecraft:iron_ingot",Count:1b}]} run data merge block ~ ~-1 ~ {Items:{}}

#旧アイテム変換
give @a[nbt={Inventory:[{id:"minecraft:trident",Count:1b,tag:{ItemName:Tech_Kit_Operator}}]}] minecraft:carrot_on_a_stick{Unbreakable: 1b, CustomModelData: 4, HideFlags: 3, display: {Lore: ['{"text":"Category:Sword","color":"gray","italic":false}','{"text":" "}','{"text":"[RClick: Blade Shot]","color":"white","italic":false}','{"text":"[Tap Sneak: Change Buddy mode]","color":"white","italic":false}','{"text":"[Hold Sneak: Call Buddy/Pickup]","color":"white","italic":false}','{"text":" "}','{"text":"Buddyの制御デバイス。見ての通り剣でもある。","color":"white","italic":false}', '{"text":"2つ合わせれば便利、ということなのだろうか。","color":"white","italic":false}', '{"text":" "}', '{"text":"Damage +7","color":"blue","italic":false}'], Name: '{"text":"Tech Kit:Operator","color":"gold","italic":false}'}, ItemName: "Tech_Kit_Operator", Damage: 0, AttributeModifiers: [{UUIDMost: 884387, UUIDLeast: 700932, Amount: 6.5d, Slot: "mainhand", AttributeName: "generic.attackDamage", Operation: 0, Name: "generic.attackDamage"}, {UUIDMost: 410939, UUIDLeast: 67339, Amount: -2.4d, AttributeName: "generic.attackSpeed", Operation: 0, Name: "generic.attackSpeed"}]}
clear @a[nbt={Inventory:[{id:"minecraft:trident",Count:1b,tag:{ItemName:Tech_Kit_Operator}}]}] trident{ItemName:Tech_Kit_Operator}
